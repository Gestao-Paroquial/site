<template>
    <style>
        @media only screen and (min-width: 500px) {
            .carousel__img {
                cursor: pointer !important;
                height: 450px !important;
                width: 100%;
            }
        }
        .carousel__img {
            height: 227px !important;
            width: 100%;
            margin-top: 62px;
        }
        .carousel {
            margin-top: 60px;
        }
    </style>
    
    <div class="container">
        <div class="row">
            <div class="masthead">
                <div class="" id="corousel">
                    <div id="myCarousel" class="carousel slide" data-ride="carousel">
                        <!-- Indicators -->
                        <ol class="carousel-indicators">
                            <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
                            <li data-target="#myCarousel2" data-slide-to="1"></li>
                            <li data-target="#myCarousel" data-slide-to="2"></li>
                        </ol>
                        
                        <!-- Wrapper for slides -->
                        <div class="carousel-inner" id="main-carousel"></div>
                        
                        <!-- Left and right controls -->
                        <a class="left carousel-control" href="#myCarousel" data-slide="prev">
                            <span class="glyphicon glyphicon-chevron-left"></span>
                            <span class="sr-only">Previous</span>
                        </a>
                        <a class="right carousel-control" href="#myCarousel" data-slide="next">
                            <span class="glyphicon glyphicon-chevron-right"></span>
                            <span class="sr-only">Next</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<script>
    var this_doc = window.document.currentScript.ownerDocument;
    class CorouselComponent extends HTMLElement {
        constructor (){
            super();
            
            const xmlhttp = new XMLHttpRequest();
            const url = "http://localhost:3000/carrousel";
            
            xmlhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    let data = JSON.parse(this.responseText);
                    createCorousel(data);
                }
            }
            
            xmlhttp.open('GET', url, true);
            xmlhttp.send();
        }
    }
    
    function createCorousel(data) {
        if (data){
            var template = this_doc.querySelector('template');
            var clone = document.importNode(template.content, true);
            var mainCarousel = clone.querySelector('#main-carousel');
            var carousel = document.querySelector('home-carousel');
            
            data.forEach(function (carouselItem) {
                var div = document.createElement('div');
                div.className = 'item';
                
                var a = document.createElement('a');
                var href = document.createAttribute('href');
                href.value = carouselItem.destinoDoSlider;
                a.setAttributeNode(href);
                
                var img = document.createElement('img');
                var src = document.createAttribute('src');
                var alt = document.createAttribute('alt');
                src.value = carouselItem.imagem;
                alt.value = carouselItem.descricao;
                img.setAttributeNode(src);
                img.setAttributeNode(alt);
                img.className = 'carousel__img img-responsive';
                
                a.appendChild(img);
                div.appendChild(a);

                mainCarousel.appendChild(div);
            });
            carousel.appendChild(mainCarousel);
        } else {
            var mainCarousel = document.getElementById('main-carousel');
            no_image_carousel = '<div class="item"><img src="http://www.acidigital.com//imagespp/size680/Sao_Lucas.jpg"/></div>';
            mainCarousel.innerHTML(no_image_carousel);
        }
        
        var firstDiv = mainCarousel.firstElementChild;
        firstDiv.className = 'item active';
    }
    
    window.customElements.define('home-carousel', CorouselComponent);
</script>